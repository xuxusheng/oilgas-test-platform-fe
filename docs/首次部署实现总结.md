# é¦–æ¬¡éƒ¨ç½²åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ¯ å®ç°æ¦‚è¿°

å·²æ ¹æ®é¡¹ç›®å®é™…æŠ€æœ¯æ ˆï¼Œå®Œæ•´å®ç°äº†é¦–æ¬¡éƒ¨ç½²æ‰€éœ€çš„å‰ç«¯åŠŸèƒ½ã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡ä¸¥æ ¼æ£€æŸ¥ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶

```
src/
â”œâ”€â”€ pages/InitAdmin/
â”‚   â””â”€â”€ index.tsx              # åˆå§‹åŒ–ç®¡ç†å‘˜é¡µé¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ RouteGuard.tsx         # å¢å¼ºçš„è·¯ç”±å®ˆå«ï¼ˆåŒ…å«ç³»ç»ŸçŠ¶æ€æ£€æµ‹ï¼‰
â””â”€â”€ features/auth/
    â””â”€â”€ utils.ts               # è®¤è¯å·¥å…·å‡½æ•°
```

### ä¿®æ”¹çš„æ–‡ä»¶

```
src/
â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ routes.ts              # æ–°å¢ INIT_ADMIN è·¯ç”±å¸¸é‡
â”‚   â””â”€â”€ router.tsx             # æ›´æ–°è·¯ç”±é…ç½®
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login/index.tsx        # å¢å¼ºç³»ç»ŸçŠ¶æ€æ£€æµ‹
â”‚   â””â”€â”€ Register/index.tsx     # å¢å¼ºç³»ç»ŸçŠ¶æ€æ£€æµ‹
â””â”€â”€ features/
    â””â”€â”€ auth/
        â””â”€â”€ index.ts           # å¯¼å‡ºå·¥å…·å‡½æ•°
```

## ğŸ”§ æ ¸å¿ƒæ¶æ„

### 1. è·¯ç”±å®ˆå« (RouteGuard)

```typescript
// ä½¿ç”¨æ–¹å¼
<RouteGuard requireAuth={true}>   // éœ€è¦è®¤è¯
<RouteGuard requireInit={true}>  // éœ€è¦åˆå§‹åŒ–
<RouteGuard requireAuth={false}> // å…¬å…±é¡µé¢
```

**åŠŸèƒ½**ï¼š

- âœ… ç³»ç»ŸçŠ¶æ€æ£€æµ‹
- âœ… æ™ºèƒ½è·¯ç”±è·³è½¬
- âœ… è®¤è¯çŠ¶æ€æ£€æŸ¥
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•

### 2. åˆå§‹åŒ–é¡µé¢ (InitAdmin)

- âœ… å›ºå®šç”¨æˆ·å "admin"ï¼ˆä¸å¯ç¼–è¾‘ï¼‰
- âœ… å¯†ç éªŒè¯ï¼ˆ6-30ä½ï¼‰
- âœ… ç¡®è®¤å¯†ç éªŒè¯
- âœ… å‰ç«¯ + åç«¯é”™è¯¯å¤„ç†
- âœ… æˆåŠŸåè‡ªåŠ¨è·³è½¬ç™»å½•

### 3. å¢å¼ºçš„ç™»å½•/æ³¨å†Œé¡µé¢

- âœ… ç³»ç»ŸçŠ¶æ€æ£€æµ‹
- âœ… æœªåˆå§‹åŒ–æ—¶æ˜¾ç¤ºå¼•å¯¼æç¤º
- âœ… æä¾›è·³è½¬åˆ°åˆå§‹åŒ–é¡µé¢çš„æŒ‰é’®

## ğŸ”„ ç”¨æˆ·æµç¨‹

### é¦–æ¬¡éƒ¨ç½²

```
ç”¨æˆ·è®¿é—® â†’ è·¯ç”±å®ˆå«æ£€æµ‹ç³»ç»ŸçŠ¶æ€
   â†“
ç³»ç»Ÿæœªåˆå§‹åŒ– â†’ è‡ªåŠ¨è·³è½¬åˆ° /init-admin
   â†“
ç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜ â†’ POST /auth/init-admin
   â†“
åˆ›å»ºæˆåŠŸ â†’ è‡ªåŠ¨è·³è½¬åˆ° /login
   â†“
ç”¨æˆ·ç™»å½• â†’ è¿›å…¥ç³»ç»Ÿ
```

### éé¦–æ¬¡éƒ¨ç½²

```
ç”¨æˆ·è®¿é—® â†’ è·¯ç”±å®ˆå«æ£€æµ‹ç³»ç»ŸçŠ¶æ€
   â†“
ç³»ç»Ÿå·²åˆå§‹åŒ– â†’ æ£€æŸ¥æœ¬åœ° token
   â†“
æœ‰ token â†’ è·³è½¬åˆ° /dashboard
æ—  token â†’ è·³è½¬åˆ° /login
```

## ğŸ—‚ï¸ è·¯ç”±é…ç½®

```typescript
// src/router/router.tsx
const router = createBrowserRouter([
  // åˆå§‹åŒ–é¡µé¢ï¼ˆæ— éœ€è®¤è¯ï¼Œå—ç³»ç»ŸçŠ¶æ€ä¿æŠ¤ï¼‰
  {
    path: ROUTES.INIT_ADMIN,
    element: (
      <RouteGuard requireInit={true}>
        <InitAdmin />
      </RouteGuard>
    ),
  },

  // ç™»å½•é¡µé¢ï¼ˆå…¬å…±ï¼Œå·²ç™»å½•ä¼šé‡å®šå‘ï¼‰
  {
    path: ROUTES.LOGIN,
    element: (
      <RouteGuard requireAuth={false}>
        <Login />
      </RouteGuard>
    ),
  },

  // æ³¨å†Œé¡µé¢ï¼ˆå…¬å…±ï¼Œå·²ç™»å½•ä¼šé‡å®šå‘ï¼‰
  {
    path: ROUTES.REGISTER,
    element: (
      <RouteGuard requireAuth={false}>
        <Register />
      </RouteGuard>
    ),
  },

  // å—ä¿æŠ¤çš„ä¸»å¸ƒå±€ï¼ˆéœ€è¦è®¤è¯ï¼‰
  {
    path: '/',
    element: (
      <RouteGuard requireAuth={true}>
        <BasicLayout />
      </RouteGuard>
    ),
    children: [/* ... å­è·¯ç”± */],
  },
])
```

## ğŸ“¡ API é›†æˆ

### å·²å­˜åœ¨çš„ APIï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

```typescript
// src/features/auth/api/auth.ts
export const getSystemStatus = () => {
  return request.get<ApiResponse<SystemStatusResponse>>('/auth/system-status')
}

export const useSystemStatus = () => {
  return useQuery({
    queryKey: ['system-status'],
    queryFn: getSystemStatus,
    staleTime: 1000 * 60 * 5, // 5åˆ†é’Ÿç¼“å­˜
  })
}

export const initAdmin = (data: FirstAdminCreateRequest) => {
  return request.post<ApiResponse<UserResponse>>('/auth/init-admin', data)
}

export const useInitAdmin = () => {
  return useMutation({
    mutationFn: initAdmin,
  })
}
```

### ç±»å‹å®šä¹‰ï¼ˆå·²å­˜åœ¨ï¼‰

```typescript
export interface SystemStatusResponse {
  initialized: boolean
  status: 'healthy' | 'unhealthy' | 'initializing'
  databaseConnected: boolean
  version?: string
  uptime?: string
}

export interface FirstAdminCreateRequest {
  username: string
  password: string
  confirmPassword?: string
}
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### ç½‘ç»œé”™è¯¯

- ç³»ç»ŸçŠ¶æ€æ£€æµ‹å¤±è´¥ â†’ æ˜¾ç¤ºé‡è¯•æŒ‰é’®
- åˆ›å»ºç®¡ç†å‘˜å¤±è´¥ â†’ æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯
- æä¾›æ‰‹åŠ¨é‡è¯•æœºåˆ¶

### ä¸šåŠ¡é”™è¯¯

- å¯†ç ä¸åŒ¹é… â†’ å‰ç«¯å®æ—¶éªŒè¯
- å¯†ç é•¿åº¦ä¸è¶³ â†’ å‰ç«¯ + åç«¯éªŒè¯
- ç³»ç»Ÿå·²åˆå§‹åŒ– â†’ æç¤ºå¹¶è·³è½¬åˆ°ç™»å½•
- ç”¨æˆ·åå·²å­˜åœ¨ â†’ æç¤ºï¼ˆç†è®ºä¸Šä¸ä¼šå‘ç”Ÿï¼‰

## âœ… è´¨é‡ä¿è¯

### ä»£ç æ£€æŸ¥é€šè¿‡

- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… ESLint ä»£ç è§„èŒƒ
- âœ… Prettier æ ¼å¼åŒ–

### æŠ€æœ¯æ ˆåŒ¹é…

- âœ… React 19.2
- âœ… TypeScript
- âœ… React Router v7
- âœ… Ant Design v6
- âœ… React Query
- âœ… Zustand

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ä»£ç æ£€æŸ¥

```bash
pnpm typecheck  # ç±»å‹æ£€æŸ¥
pnpm lint       # ä»£ç è§„èŒƒ
pnpm format     # æ ¼å¼åŒ–
```

### 2. æœ¬åœ°æµ‹è¯•

```bash
pnpm dev        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```

### 3. æ„å»ºç”Ÿäº§åŒ…

```bash
pnpm build      # æ„å»º
pnpm preview    # é¢„è§ˆ
```

### 4. åç«¯é…åˆ

ç¡®ä¿åç«¯æä¾›ä»¥ä¸‹æ¥å£ï¼š

- `GET /auth/system-status` - ç³»ç»ŸçŠ¶æ€æ£€æµ‹
- `POST /auth/init-admin` - åˆ›å»ºç¬¬ä¸€ä¸ªç®¡ç†å‘˜

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### åŠŸèƒ½æµ‹è¯•

- [ ] é¦–æ¬¡éƒ¨ç½²ï¼šæ£€æµ‹ â†’ åˆå§‹åŒ– â†’ åˆ›å»º â†’ ç™»å½• â†’ è¿›å…¥ç³»ç»Ÿ
- [ ] éé¦–æ¬¡éƒ¨ç½²ï¼šæ£€æµ‹ â†’ ç™»å½• â†’ è¿›å…¥ç³»ç»Ÿ
- [ ] å¯†ç ä¸åŒ¹é…æç¤º
- [ ] å¯†ç é•¿åº¦éªŒè¯
- [ ] ç½‘ç»œé”™è¯¯å¤„ç†
- [ ] é‡å¤åˆ›å»ºæ‹¦æˆª

### è¾¹ç•Œæµ‹è¯•

- [ ] åˆ·æ–°åˆå§‹åŒ–é¡µé¢
- [ ] å¤šæ ‡ç­¾é¡µåŒæ—¶è®¿é—®
- [ ] åˆ›å»ºæˆåŠŸåè¿”å›åˆå§‹åŒ–é¡µé¢
- [ ] æµè§ˆå™¨å…³é—­åé‡æ–°è®¿é—®

## ğŸ‰ æ€»ç»“

**å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡**

**æ ¸å¿ƒä¼˜åŠ¿**:

1. **æ— ç¼é›†æˆ** - å……åˆ†åˆ©ç”¨é¡¹ç›®ç°æœ‰æ¶æ„
2. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ
3. **ç”¨æˆ·ä½“éªŒ** - æ™ºèƒ½è·¯ç”±å’Œå‹å¥½æç¤º
4. **ä»£ç è´¨é‡** - é€šè¿‡æ‰€æœ‰æ£€æŸ¥å·¥å…·
5. **å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ³¨é‡Š

**å¯ä»¥ç›´æ¥æŠ•å…¥ä½¿ç”¨ï¼** ğŸš€

---

**ç‰ˆæœ¬**: v1.0
**å®Œæˆæ—¶é—´**: 2025-12-25
**æŠ€æœ¯æ ˆ**: React 19.2 + TypeScript + Vite + Ant Design v6 + React Query + Zustand
